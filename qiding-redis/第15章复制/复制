1.从服务器
   slave of 设置成从服务器

sync实现
   从服务器给主服务器发送sync命令
   执行bgsave生成rdb文件
   把rdb文件发送给从服务器
   从服务器载入配置文件

psync （完整重同步）+（部分重同步）


  完全同步的实现
     主服务器的复制偏移量，从服务器的复制偏移量
     主服务器的积压缓冲区
     服务器id


  部分复制的实现
     主服务器执行命令，会把命令放入复制积压缓冲区（偏移量+数据）
     1008  1009   1100
     set    a      b

  从服务器 1009
     如果不数据在积压缓冲区，全量复制



 从服务器保存的是主服务器的   运行ID
   如果运行ID和当前的主服务器不一致，则全量复制


 复制操作
   主服务器返回fullressync ruuid offset
   返回 countine
   返回 error

复制实现
     1.建立套接字
     2.发送ping/pong
     3.认证 requirepass，masterauth
     4.从给主发送端口信息
     5.同步、互为主从
     6.命令传播

心跳检测
   从发送 replication ACK offset
     1。保持连接
     2。当服务器少于n个，或者心跳间隔延迟大于 m，拒绝写请求
     3。检测命令丢失






